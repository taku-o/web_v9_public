.. vim:set expandtab ff=unix ft=rest nowrap :

..  Vimball : インストールしたvimスクリプトを管理するプラグイン

..  このページではvimエディタのバージョン7から同梱されているスクリプト、Vimballの使い方を紹介します。
    Vimballはvimスクリプトのパッケージマネージャーのようなツールで、
    Vimball独自の形式のアーカイブファイルからスクリプトをインストールしたり、
    インストールしたスクリプトをアンインストールしたりできます。
    (Windows, Mac)

.. |BR| raw:: html

    <br />

.. |yen|    unicode:: U+000A5 .. YEN SIGN

.. role:: raw-html(raw)
    :format: html

.. contents::

================================================================================
概要
================================================================================

Vimball : vim-based archiver: builds, extracts, and previews |BR|
http://www.vim.org/scripts/script.php?script_id=1502

このページではvimエディタのバージョン7から同梱されているスクリプト、Vimballの使い方を紹介します。 |BR|
Vimballはvimスクリプトのパッケージマネージャーのようなツールで、
Vimball独自の形式のアーカイブファイルからスクリプトをインストールしたり、 |BR|
インストールしたスクリプトをアンインストールしたりできます。

.. image:: /dist/img/vim/vimball_flow.jpg
    :alt:  Vimball形式のファイルでインストール



================================================================================
インストール方法
================================================================================

Vimballはvimエディタのバージョン7から同梱されているので、
最新のバージョンを使用しているなら、新たにVimballを入れる必要はありません。 |BR|
古いバージョンのVimballを使用していて、最新のVimballに入れ替える場合は、 |BR|
古いバージョンを削除してから、新しいバージョンのVimballスクリプトをコピーしてください。

.. csv-table::
    :header: ファイル, URL

    vimball.tar.gz, http://www.vim.org/scripts/script.php?script_id=1502



================================================================================
Vimball形式で配布されたスクリプトをインストールする
================================================================================

基本的なインストール方法
--------------------------------------------------------------------------------

Vimballアーカイブファイルは通常、拡張子「.vba」のファイルとして配布されます。 |BR|
このVimballアーカイブファイルからスクリプトをインストールするには、 |BR|
vimエディタで拡張子「.vba」のファイルを開き、次のコマンドを実行してください。

.. parsed-literal::
    :class: console

    **" Vimball形式のファイルからスクリプトをインストールする**
    :source %

.. image:: /dist/img/vim/vimball_open.jpg
    :alt:  vimballをエディタで開いて

↓ インストールするには、まずエディタで.vbaファイルを開いてから、「:source %」コマンドを実行します。

.. image:: /dist/img/vim/vimball_install.jpg
    :alt:  「:source」コマンドでインストール

.. note::

    vimエディタの「runtimepath」の設定ディレクトリを順に検索し、
    最初に利用可能なディレクトリがインストール先ディレクトリとなります。 |BR|
    通常は「$HOME/vimfiles」か「$HOME/.vim」があればそのディレクトリに、 |BR|
    なければvimエディタのインストールディレクトリにインストールされることになります。


インストール先を変更する
--------------------------------------------------------------------------------

Vimballでスクリプトをインストールする場合、vimエディタの「runtimepath」オプションの設定ディレクトリを順に検索し、 |BR|
最初に利用可能なディレクトリに、スクリプトがインストールされます。 |BR|
インストール先ディレクトリを変更するには、vimエディタの「runtimepath」オプションを変更するか、 |BR|
「g:vimball_home」変数でインストール先ディレクトリを指定します。

.. parsed-literal::
    :class: program

    **" vimエディタの設定ファイルで、インストール先ディレクトリを指定**
    :let g:vimball_home = "C:/Users/home"


インストールされるファイルを確認する
--------------------------------------------------------------------------------

Vimballでインストールされるファイルのリストを確認するには、 |BR|
インストールするVimball形式のファイルをvimエディタで開いてから、次のコマンドを実行します。

.. parsed-literal::
    :class: console

    **" インストールされるファイルを確認する**
    :VimballList

.. image:: /dist/img/vim/vimball_list.jpg
    :alt:  「:VimballList」コマンドでインストールファイルを表示


Vimballアーカイブファイルでのインストールで行われること
--------------------------------------------------------------------------------

Vimballでスクリプトをインストールすると、

- インストール先ディレクトリに必要なファイルがコピーされます。
- docディレクトリのファイルに「:helptags」コマンドが実行されます。
- インストール先ディレクトリの「.VimballRecord」ファイルにインストール情報が記録されます。

「.VimballRecord」ファイルに記録した情報は、アンインストール時、再インストール時に使用されます。



================================================================================
Vimballでインストールしたスクリプトをアンインストールする
================================================================================

基本的なアンインストール方法
--------------------------------------------------------------------------------

Vimball形式のアーカイブファイルでスクリプトをインストールした場合は、 |BR|
そのスクリプトを「:RmVimball」コマンドでアンインストールできます。

.. parsed-literal::
    :class: console

    :RmVimball {拡張子「.vba」ファイルのファイル名}

アンインストールする場合に指定する「.vba」ファイルのファイル名にはファイルまでのパスを含みません。ファイル名のみを指定します。 |BR|
ファイル名を忘れてしまった場合は、インストール情報を記録している「.VimballRecord」ファイルを見てください。

.. parsed-literal::
    :class: console

    **" アンインストールする場合のコマンドの例**
    :RmVimball rainbow-4.0.vba


アンインストール処理を行うディレクトリを指定する
--------------------------------------------------------------------------------

アンインストール処理を行う先のディレクトリは、インストール時と同じく、 |BR|
vimエディタの「runtimepath」オプションの設定ディレクトリを順に検索し、 |BR|
最初に利用できるディレクトリとなります。

この条件に合わないディレクトリにインストールしたスクリプトをアンインストールするには、 |BR|
vimエディタの設定ファイルでインストール先ディレクトリを示す「g:vimball_home」変数を設定するか、

.. parsed-literal::
    :class: program

    **" vimエディタの設定ファイルで、インストール先ディレクトリを指定**
    :let g:vimball_home = "C:/Users/home"

「:RmVimball」コマンド実行時にアンインストール処理を行うディレクトリを指定します。

.. parsed-literal::
    :class: console

    **" アンインストールディレクトリを指定する場合のコマンド例**
    :RmVimball rainbow-4.0.vba C:/Users/home



================================================================================
Vimball形式のアーカイブファイルを作成する
================================================================================

配布用のVimball形式のファイルを作成する最も基本的な方法を説明します。 |BR|
この章の情報はvimスクリプトを、Vimballで配布したい方にのみ必要となります。


インストールさせたい構成で、ファイルを特定ディレクトリに配置する
--------------------------------------------------------------------------------

まず適当なディレクトリを用意し（$HOME/vimfiles、$HOME/.vimでも構わない）、 |BR|
そのディレクトリにインストールするファイルを配置します。

.. parsed-literal::
    :class: program

    **あるディレクトリ以下にインストールするファイルを置く（例）**
    directory/
      |
      +-- autoload/
      |     |
      |     +-- Align.vim
      |
      +-- doc/
      |     |
      |     +-- Align.txt
      |
      +-- plugin/
            |
            +-- AlignMaps.vim
            +-- AlignPlugin.vim


Vimballアーカイブファイルの構成を書いたファイルを用意する
--------------------------------------------------------------------------------

テキストファイルを用意して、
そのファイルにインストールするファイルの一覧を書きます。 |BR|
（仮に「filelist.txt」としておきます）

.. parsed-literal::
    :class: program

    **一覧ファイルの書き方サンプル**
    autoload/Align.vim
    doc/Align.txt
    plugin/AlignMaps.vim
    plugin/AlignPlugin.vim


vimエディタを起動し、カレントディレクトリを配布ファイルディレクトリに変更する
--------------------------------------------------------------------------------

vimエディタを起動し、カレントディレクトリを配布ファイルディレクトリのルートディレクトリに変更します。 |BR|
ディレクトリの移動には「:cd」コマンドが利用できます。

.. note::

    Windowsの場合はルートディレクトリにファイルを置いて、 |BR|
    そのファイルを「Shift」キーを押しながらvimエディタで開くと、楽に移動できます。

    .. image:: /dist/img/vim/vimball_shift_to_vim.jpg
        :alt:  Shiftキーを押しながらドロップ


一覧ファイルをvimエディタで開く
--------------------------------------------------------------------------------

インストールファイル一覧をvimエディタで開きます。 |BR|
（このファイルは、さきほど作成した「filelist.txt」のことです。）


「:MkVimball」コマンドでVimballアーカイブファイルを作成する
--------------------------------------------------------------------------------

ここまでの作業で、カレントディレクトリを配布ファイルディレクトリルートにし、
インストールファイル一覧をvimエディタで開いたら、 |BR|
「:MkVimball」コマンドを実行し、Vimballアーカイブファイルを作成します。

.. parsed-literal::
    :class: console

    :%MkVimball {作成するVimballファイル名}

.. parsed-literal::
    :class: console

    **" 「:MkVimball」コマンドの実行例**
    :%MkVimball rainbow-4.0.vba

これでVimballファイルが作成されます。 |BR|
動作確認を行ったら、このアーカイブファイルを配布してください。



================================================================================
注意事項など
================================================================================

Vimballには、現状、問題点が少なくとも1つあります。

Vimballアーカイブファイルのファイル名に"[1]"、"[2]"、"[3]"などが含まれていると、 |BR|
インストールは成功するものの、Vimballによるアンインストールが空振りします。 |BR|
（アンインストールが失敗します）

この問題はファイル名に"[1]"などの文字が入っていたら、
その文字を取り除くだけで回避できますが、 |BR|
Internet Explorerを使用している方はダウンロードファイルのファイル名に
"[1]"が入りやすいようなので、気をつけてください。




