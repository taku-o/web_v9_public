.. vim:set expandtab ff=unix ft=rest :

..  vimエディタが（勝手に）作成する、一見、不要に見えるファイルが何をしているか

..  このページではvimエディタにより自動的に作成される、
    スワップファイル、バックアップファイル、viminfoファイルがどのような役割を持ったファイルであるか、
    ファイルの出力先を変更するには、ファイルの生成を止めるには、どうすればよいか、
    について説明します。
    (Windows, Mac)

.. |BR| raw:: html

    <br />

.. |yen|    unicode:: U+000A5 .. YEN SIGN

.. role:: raw-html(raw)
    :format: html

.. contents::

================================================================================
概要
================================================================================

このページではvimエディタにより自動的に作成される、 |BR|
スワップファイル、バックアップファイル、viminfoファイルがどのような役割を持ったファイルであるか、 |BR|
ファイルの出力先を変更するには、ファイルの生成を止めるには、どうすればよいか、について説明します。



================================================================================
.swpファイル
================================================================================

.swpファイルはどのような役割をもったファイルか
--------------------------------------------------------------------------------

.swpファイルはスワップファイルと呼ばれています。 |BR|
スワップファイルはアプリケーションのクラッシュに備えて、
vimエディタでの編集開始時に作成され、編集後に削除される編集情報の記録ファイルです。 |BR|
スワップファイルを使用していれば、vimエディタがシステムエラーで強制終了しても、
保存前のデータが失われずに済みことがあります。


スワップファイルの使い方
--------------------------------------------------------------------------------

スワップファイルを使用しての保存前データのリカバリーの方法については、 |BR|
別の記事に内容をまとめています。そちらの記事をご覧ください。

`swapファイルが見つかった場合にどのように対処すべきか（クラッシュからのリカバリー）`__

__ /articles/howto/crash-recovery.html


スワップファイルの出力先を変更する
--------------------------------------------------------------------------------

スワップファイルの作成ディレクトリを変更するには、 |BR|
「directory」オプションで出力先ディレクトリを指定します。

.. parsed-literal::
    :class: program

    **" この設定はvimエディタの設定ファイルに書きます。**
    **" Windowsの場合のスワップファイルの作成ディレクトリ指定の例。**
    :set directory=C:/Temp
    :set directory=~/vimfiles/tmp
    :set directory=.
    
    **" Mac OSXの場合のスワップファイルの作成ディレクトリ指定の例。**
    :set directory=/tmp
    :set directory=~/.vim/tmp
    :set directory=.


スワップファイルを作成しない
--------------------------------------------------------------------------------

スワップファイルを作成したくない場合は、 |BR|
vimエディタの設定ファイルで「swapfile」オプションをnoにセットします。

.. parsed-literal::
    :class: program

    **" スワップファイルを作成しない**
    :set noswapfile

.. note::

    逆にswapfileオプションを有効にするには、次のように指定します。

    .. parsed-literal::
        :class: program

        :set swapfile



================================================================================
~（チルダ）ファイル
================================================================================

~（チルダ）ファイルはどのような役割をもったファイルか
--------------------------------------------------------------------------------

ファイル名に「~（チルダ）」が付いたファイルはバックアップファイルです。
ファイルを保存時に、変更前のファイルをもとにして作成されます。 |BR|
ファイルの編集に失敗しても、このバックアップファイルを使用して、
一つ前の世代まではファイルの状態を戻せます。

.. parsed-literal::
    :class: console

    sample.txt

     ↓ 「~」のついたバックアップファイルが作成される

    sample.txt~



バックアップファイルによるバックアップ
--------------------------------------------------------------------------------

バックアップファイルを使用して一つ前の世代まで戻す場合は、 |BR|
vimエディタ側でのサポートは特に無いので、手作業でリカバリー作業を行います。

#. 現行のファイルを削除する。
#. バックアップファイルをリネームする。


バックアップファイルの出力先を変更する
--------------------------------------------------------------------------------

バックアップファイルが作成されるディレクトリを変更するには、 |BR|
「backupdir」オプションで出力先ディレクトリを指定します。

.. parsed-literal::
    :class: program

    **" この設定はvimエディタの設定ファイルに書きます。**
    **" Windowsの場合のバックアップファイルの作成ディレクトリ指定の例。**
    :set backupdir=C:/Temp
    :set backupdir=~/vimfiles/tmp
    :set backupdir=.
    
    **" Mac OSXの場合のバックアップファイルの作成ディレクトリ指定の例。**
    :set backupdir=/tmp
    :set backupdir=~/.vim/tmp
    :set backupdir=.


バックアップファイルを作成しない
--------------------------------------------------------------------------------

バックアップファイルを作成したくない場合は、 |BR|
vimエディタの設定ファイルで「backup」オプションを無効にします。

.. parsed-literal::
    :class: program

    **" バックアップファイルを作成しない**
    :set nobackup

.. note::

    backupオプションを有効にするには次のように指定します。

    .. parsed-literal::
        :class: program

        :set backup



================================================================================
.viminfoファイル
================================================================================

.viminfoファイルははどのような役割をもったファイルか
--------------------------------------------------------------------------------

.viminfo、_viminfoファイルは、コマンド、編集情報、検索情報、レジスタなどの
履歴情報を保存しているファイルです。 |BR|
このファイルはvimエディタの終了時に作成され、次回のvimエディタ起動時に、
状態を復元するために使用されます。


viminfoファイルの使い方
--------------------------------------------------------------------------------

vimエディタの「viminfo」オプションを変更することにより、 |BR|
viminfoファイルでどのようなデータを保存するか、 |BR|
viminfoファイルからどのデータを読み込むかを指定できます。

「viminfo」オプションの詳細については、vimエディタのヘルプファイル、21.3の項を参照して下さい。

.. parsed-literal::
    :class: console

    :help 21.3


viminfoファイルの出力先を変更する
--------------------------------------------------------------------------------

viminfoファイルの出力先も変更できます。 |BR|
viminfoファイルの出力先は、「viminfo」オプションの「n」フラグで指定します。

.. parsed-literal::
    :class: program

    :set viminfo={他のフラグ...},n{ファイルパス}
    
    **" 今のviminfoの設定に追加するとしたら、このように設定**
    :set viminfo+=n{ファイルパス}


「viminfo」オプションの「n」フラグは、全フラグ中、最後に指定しなければなりません。 |BR|
そうしないと、「n」フラグ以降に指定したフラグがファイルパスの一部として解釈され、エラーが発生します。

.. parsed-literal::
    :class: program

    **" この設定はvimエディタの設定ファイルに書きます。**
    **" Windowsの場合のviminfoファイルの指定の例。**
    :set viminfo+=n~/vimfiles/tmp/viminfo.txt
    :set viminfo+=nC:/Temp/viminfo.txt
    
    **" Mac OSXの場合のviminfoファイルの指定の例。**
    :set viminfo+=n~/.vim/tmp/viminfo.txt
    :set viminfo+=n/tmp/viminfo.txt


viminfoファイルを作成しない
--------------------------------------------------------------------------------

「viminfo」オプションに何のフラグも設定しなければ、
viminfoファイルの作成、および、読込は行わなくなります。 |BR|
vimエディタの設定ファイルで次のように指定してください。

.. parsed-literal::
    :class: program

    **" viminfoファイルを作成しない**
    :set viminfo=



================================================================================
注意事項など
================================================================================

このページで紹介したファイル、スワップファイル、バックアップファイル、viminfoファイルには、
ファイルに書き込んだ内容や、入力した情報が書き込まれています。
上で紹介しているように、ファイルの生成パスを変更することはできますが、
マルチユーザ環境では出力先のディレクトリに気をつけないと、
他のユーザに作業内容を覗かれる可能性があります。 |BR|
（たとえば、共有のTempディレクトリにファイルを作成する設定にしておいてから、
vimエディタでパスワードのメモしたら、パスワードを読み取られるかも..）




