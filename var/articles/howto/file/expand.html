.. vim:set expandtab ff=unix ft=rest :

..  vimエディタから、いろいろなパターンの方法でファイルを開く

..  本記事では、vimエディタで利用できる様々なパターンのファイルの開き方、保存の仕方を紹介します。
    中にはあまり利用しない方法もあるでしょうが、読んでみてください。
    (Windows, Mac)

.. |BR| raw:: html

    <br />

.. |yen| unicode:: U+000A5 .. YEN SIGN

.. role:: raw-html(raw)
    :format: html

.. contents::

================================================================================
概要
================================================================================

本記事では、vimエディタで利用できる様々なパターンのファイルの開き方、保存の仕方を紹介します。 |BR|
中にはあまり利用しない方法もあるでしょうが、読んでみてください。



================================================================================
ファイルパスの操作
================================================================================

ファイルパスを取得する
--------------------------------------------------------------------------------

ファイルの保存 :raw-html:`<kbd>:write</kbd>` など一部のvimエディタのコマンドで「%」「#」「#{数値}」を使用すると、 |BR|
「%」「#」「#{数値}」がファイルのパスに置き換えられてから、コマンドが実行されます。

.. csv-table::
    :header: キーワード, 説明

    %, 今開いているファイルのパス。
    #, 代替ファイルのパス。多くの場合、一つ前に開いていたファイルのパスになります。
    #{数値}, 指定したバッファ番号のファイルのパス。

ファイルのパーミッションが足りない時の一時的なファイルの作成時や |BR|
ファイルをバックアップする時などに、この機能は便利です。

.. parsed-literal::
    :class: console

    **" カレントファイルのファイル名に拡張子「.txt」を付けて保存**
    **" hello.html → hello.html.txt**
    :w %.txt
    
    **" 5番のバッファのファイル名に拡張子「.bk」を付けたバックアップを作成**
    **" hello.html → hello.html.bk**
    :w #5.bk
    
    **" カレントファイルのバックアップファイルを開く**
    **" hello.html → hello.html.bk**
    :e %.bk


既存の拡張子を取り除く
--------------------------------------------------------------------------------

前章で説明した「%」「#」「#{数値}」に「<」を付けて、「%<」「#<」「#{数値}<」とすると、 |BR|
拡張子無しのファイルのパスを取得できます。

.. csv-table::
    :header: キーワード, 説明

    %<, 今開いているファイルのパス（拡張子無し）。
    #<, 代替ファイルのパス（拡張子無し）。多くの場合、一つ前に開いていたファイルの拡張子無しのパスになります。
    #{数値}<, 指定したバッファ番号のファイルのパス（拡張子無し）。

この機能は、同じディレクトリに拡張子だけが違う一組のファイルがある、あるいは作成する
場合に利用できます。

.. parsed-literal::
    :class: console

    **" C言語のヘッダファイルを開く（同じディレクトリにある場合）**
    **" hello.c → hello.h**
    :e %<.h
    
    **" 拡張子を「.bk」に置き換えて保存**
    **" hello.c → hello.bk**
    :w %.bk


ファイルパスの置換
--------------------------------------------------------------------------------

「%」「#」「#{数値}」に「:s?{置換前テキスト}?{置換後テキスト}?」を付けると、 |BR|
パスの一部を変換できます。

.. csv-table::
    :header: キーワード, 説明

    %:s?{置換前テキスト}?{置換後テキスト}?, 今開いているファイルのパスの一部を変換。
    #:s?{置換前テキスト}?{置換後テキスト}?, 代替ファイルのパスの一部を変換。
    #{数値}:s?{置換前テキスト}?{置換後テキスト}?, 指定したバッファ番号のファイルのパスの一部を変換。
    %:gs?{置換前テキスト}?{置換後テキスト}?, 今開いているファイルのパスの一部を変換。
    #:gs?{置換前テキスト}?{置換後テキスト}?, 代替ファイルのパスの一部を変換。
    #{数値}:gs?{置換前テキスト}?{置換後テキスト}?, 指定したバッファ番号のファイルのパスの一部を変換。

.. parsed-literal::
    :class: console

    **" カレントファイルのパスに含まれる「abc」を「xyz」に変換する**
    **" abc_abc_abc.txt → xyz_abc_abc.txt**
    :e %:s?abc?xyz?
    
    **" 「:s」の代わりに、「:gs」を使用すると、マッチするテキスト全てを置換する**
    **" abc_abc_abc.txt → xyz_xyz_xyz.txt**
    :e %:gs?abc?xyz?

この置換機能を多用することはあまりないでしょうが、 |BR|
たとえば、連番ファイルなど、ファイル名のほんの一部だけが違うファイルを開く時には |BR|
覚えておくと役に立つことがあります。

.. parsed-literal::
    :class: program

    **" ap350xu419.pl**
    
    :e %:s?419?420?
    **" ↓ （419を420に置換）**
    **" ap350xu420.pl が開かれる**
    
    :e %:s?420?421?
    **" ↓ （420を421に置換）**
    **" ap350xu421.pl が開かれる**
    
    :e %:s?421?422?
    **" ↓ （421を422に置換）**
    **" ap350xu422.pl が開かれる**



================================================================================
ディレクトリの操作
================================================================================

ファイルのディレクトリを取得する
--------------------------------------------------------------------------------

「%」「#」「#{数値}」に「:h」を付けて、「%:h」「#:h」「#{数値}:h」とすると、 |BR|
ファイルのあるディレクトリまでのパスを取得できます。

.. csv-table::
    :header: キーワード, 説明

    %:h, 今開いているファイルのディレクトリのパス。
    #:h, 代替ファイルのディレクトリのパス。
    #{数値}:h, 指定したバッファ番号のファイルのディレクトリのパス。

これを覚えておくと、指定ファイルのディレクトリに移動する時などに便利です。

.. parsed-literal::
    :class: console

    **" カレントディレクトリをファイルのディレクトリに変更する**
    :cd %:h
    
    **" 3番のバッファと同じディレクトリにsample.txtファイルを作成**
    :w #3:h/sample.txt

.. note::

    Kaoriyaパッチ入りのvimエディタには、

    - カレントファイルと同じディレクトリに移動する :raw-html:`<kbd>:CdCurrent</kbd>` コマンドと、
    - コマンドラインモードで :raw-html:`<kbd>Control-x</kbd>` を押すと、カレントファイルのディレクトリまでのパスを補完する機能

    が用意されています。

    .. parsed-literal::
        :class: console

        **" 下2つのコマンドはどちらも同じ機能**
        :CdCurrent
        
        :cd %:h

    参考：
    `cmdex.vim : Kaoriyaパッチ ユーティリティコマンド集`__

    __ /articles/vim/cmdex_vim.html


別のディレクトリに同じ名前のファイルを作成する
--------------------------------------------------------------------------------

「%」「#」「#{数値}」に「:t」を付けるとファイルの名前だけ、
「:r」を付けると拡張子無しのファイルパスを取得できます。 |BR|
両方を組み合わせて、同時に使用することもできます。

.. csv-table::
    :header: キーワード, 説明

    %:t, 今開いているファイルのファイル名。
    #:t, 代替ファイルののファイル名。
    #{数値}:t, 指定したバッファ番号のファイルのファイル名。
    %:t:r, 今開いているファイルのファイル名（拡張子無し）。
    #:t:r, 代替ファイルののファイル名（拡張子無し）。
    #{数値}:t:r, 指定したバッファ番号のファイルのファイル名（拡張子無し）。

たとえば、同じファイル名のファイルを別のディレクトリに作成したい場合などで、
この方法を利用できます。

.. parsed-literal::
    :class: console

    **" fooディレクトリに同じファイル名のファイルを作成**
    **" 例） sample.txt → foo/sample.txt**
    :w foo/%:t
    
    **" fooディレクトリに同じファイル名で、拡張子「.bk」のファイルを作成**
    **" 例） sample.txt → foo/sample.bk**
    :w foo/%:t:r.bk



================================================================================
ワイルドカード
================================================================================

ファイルを検索して開く
--------------------------------------------------------------------------------

ワイルドカードを使用すると、
まずパターンに合うファイルを検索し、ファイルが見つかったら開く、
といった処理を行えます。

.. csv-table::
    :header: キーワード, 説明

    "\*", 0文字以上の全ての文字にマッチする。
    "\?", 1文字にマッチする。
    "[ABC]", Aか、Bか、Cにマッチする。

.. parsed-literal::
    :class: console

    **" abcで始まる拡張子「.txt」のファイルを開く**
    **" 例） abcdef.txt**
    :e abc\*.txt
    
    **" abcで始まり、次に1文字続く、拡張子「.txt」のファイルを開く**
    **" 例） abcd.txt**
    :e abc?.txt
    
    **" abcで始まり、次にoか、pの文字がくる、拡張子「.txt」のファイルを開く**
    **" 例） abco.txt**
    :e abc[op].txt

.. note::

    :raw-html:`<kbd>:edit</kbd>` コマンドでは複数のファイルを開けないので、 |BR|
    複数のファイルを開きたい場合は :raw-html:`<kbd>:args</kbd>` コマンドを使用すると良い。

    .. parsed-literal::
        :class: console

        **" abcで始まる拡張子「.txt」のファイルを全て開く**
        **" 例） abcd.txt、abcdef.txt、abc.txt**
        :args abc\*.txt

    参考：
    `:args」コマンドで一度に複数のファイルを開く。`__

    __ /articles/howto/file/open-manyfiles.html


下位ディレクトリからファイルを検索する
--------------------------------------------------------------------------------

「\*\*」を使用すると、下位ディレクトリ全てから、
パターンにマッチするファイルを検索できます。

.. csv-table::
    :header: キーワード, 説明

    "\*\*", 下位ディレクトリ全てに再帰的にマッチする。

この機能は、単純なファイル検索以外にも、 |BR|
:raw-html:`<kbd>:vimgrep</kbd>` コマンドによるファイル検索時に便利に利用できます。

.. parsed-literal::
    :class: console

    **" 下位ディレクトリにあるhoge.txtを開く**
    :e \*\*/hoge.txt
    
    **" src以下のディレクトリで拡張子「.java」のファイルに、「getVar」のgrep実行**
    :vimgrep getVar src/\*\*/\*.java
    **" ↓ grep検索結果の確認は「:copen」コマンドを使用する。**
    :copen


入力の手間を省くためにワイルドカードを使用する
--------------------------------------------------------------------------------

例えば、あるディレクトリに

- access_log.20080426
- access_log.20080427
- access_log.20080428
- access_log.20080429
- access_log.20080430

といったファイルがある場合は、

.. parsed-literal::
    :class: console

    :e \*0429

とコマンド入力して「access_log.20080429」ファイルを開けます。

この場合は、ファイルを検索するためではなく、
重複部分「access_log.」の入力の手間を省くために、ワイルドカードを使用しています。 |BR|
Unixに慣れた人はよくこういったワイルドカードの使い方をするので、覚えておくと良いでしょう。



================================================================================
カーソル下に記述されたファイルを開く
================================================================================

直接ファイルを開く
--------------------------------------------------------------------------------

ノーマルモードで :raw-html:`<kbd>gf</kbd>` コマンドを実行すると、
カーソル下に記述されているテキストと同じ名前のファイルを開けます。 |BR|
ウィンドウを新しく開き、そのウィンドウでファイルを開くには、
:raw-html:`<kbd>gf</kbd>` ではなく、代わりに :raw-html:`<kbd>Control-w f</kbd>` と実行します。

いくつかバリエーションがありますが、
いずれの方法もファイルが見つからない場合はエラーになります。

.. csv-table::
    :header: モード, コマンド, 説明

    "ノーマル",   "gf",          "カーソル下に書かれたテキストと同じ名前のファイルを開く"
    "ノーマル",   "gF",          " :raw-html:`<kbd>gf</kbd>` と同じだが、ファイルを開くときに行数も指定できる"
    "ビジュアル", "gf",          "選択したテキストと同じ名前のファイルを開く"
    "ノーマル",   "Control-w f", "カーソル下に書かれたテキストと同じ名前のファイルを、新しいウィンドウで開く"
    "ビジュアル", "Control-w f", "選択したテキストと同じ名前のファイルを、新しいウィンドウで開く"


一度コマンドラインにファイルパスを読み込んでから開く
--------------------------------------------------------------------------------

コマンドを実行したら、即、カーソル下に書かれたファイルを開くのではなく、 |BR|
一度、コマンドラインにカーソル下のテキストを読み込んでから、
改めてファイルを開く方法もあります。

この方法は作業が1手多い代わりに、 |BR|
・ファイルが無くてもエラーにならない（新規ファイルとして開く） |BR|
・テキストを読み込んだ後、コマンドライン上で編集してからファイルを開ける、 |BR|
という利点があります。

やり方は次のとおりです。 |BR|
まず、コマンドラインモードになり、 :raw-html:`<kbd>:e</kbd>` と入力します。

.. parsed-literal::
    :class: console

    **"（eと半角スペース）**
    :e 

次に、 :raw-html:`<kbd>Control-r Control-w</kbd>` と実行し、カーソル下のテキストを読み込みます。

.. parsed-literal::
    :class: console

    **" カーソル下に「sample.txt」と書いてあったと想定**
    :e sample.txt

最後に、そのファイルを開くので良ければ、
:raw-html:`<kbd>Enter</kbd>` キーを押してファイルを開きます。



================================================================================
その他のTips
================================================================================

ファイル区切り文字として「/」も使える
--------------------------------------------------------------------------------

Windows環境のファイル区切り文字は「\\（バックスラッシュ）」だが、 |BR|
Unix系環境と同じように「/（スラッシュ）」を使用しても問題ない。

.. parsed-literal::
    :class: console

    **" バックスラッシュ**
    :e C:\\Users\\foo\\Desktop\\sample.txt
    
    **" ↑↓ どちらの方法でもファイルを開ける。**
    
    **" スラッシュ**
    :e C:/Users/foo/Desktop/sample.txt


ホームディレクトリ、親ディレクトリのファイルを開く
--------------------------------------------------------------------------------

ホームディレクトリは「~」、カレントディレクトリの親ディレクトリは「..」で参照できる。

.. parsed-literal::
    :class: console

    **" ホームディレクトリにあるファイルを開く**
    :e ~/sample.txt
    
    **" カレントディレクトリの上のディレクトリにあるファイルを開く**
    :e ../parent.txt


環境変数を使う
--------------------------------------------------------------------------------

${変数名}で、ファイルを開く際に環境変数を利用できます。

.. parsed-literal::
    :class: console

    **" 環境変数「HOME」の示すディレクトリにあるファイルを開く**
    :e $HOME/sample.txt

特別な設定をしない場合、一般的なvimエディタ環境では、次の3つの環境変数を利用できます。

.. csv-table::
    :header: 変数, 説明

    "$HOME",       "ホームディレクトリ"
    "$VIM",        "vimエディタのインストールディレクトリ"
    "$VIMRUNTIME", "vimエディタのランタイムファイルのあるディレクトリ"

環境変数を新たに用意したい場合、上書きしたい場合は、 |BR|
:raw-html:`<kbd>:let</kbd>` コマンドを使用すれば、環境変数を設定できます。

.. parsed-literal::
    :class: program

    **" 環境変数「DESKTOP」を設定する。**
    **" バックスラッシュを使う場合はエスケープが必要。**
    **" スラッシュを使うか、シングルクォーテーションで囲むとエスケープしなくていい。**
    :let $DESKTOP = "C:/Users/foo/Desktop"
    
    **" ↓**
    
    **" 環境変数「DESKTOP」の示すディレクトリにあるファイルを開く**
    :e $DESKTOP/sample.txt



================================================================================
注意事項など
================================================================================

今回紹介した方法を使わないで、普通にファイルを開いたり、 |BR|
いくつかのファイルを一度に読み込んでからバッファ管理系プラグインで
ファイルを選択した方が早い事があります。 |BR|
状況に応じて使い分けてください。




