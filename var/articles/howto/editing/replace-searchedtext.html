.. vim:set expandtab ff=unix ft=rest :

..  検索でマッチしたテキストに対して、置換処理を実行する。

..  まず検索を実行して検索にマッチするテキストを確認し、
    そのテキストに対して置換処理を実行するなら「<C-r> /」を使うと良いでしょう。
    入力モード、コマンドラインモードで「<C-r> /」と入力すると、最後に検索に使用した検索ワードを挿入できます。
    「/」「?」を使うと、インクリメンタルサーチで細かな正規表現の結果を確認しながら検索語を作れるので、
    私はよく、この方法を使用しています。
    (Windows, Mac)

.. |BR| raw:: html

    <br />

.. |yen| unicode:: U+000A5 .. YEN SIGN

.. role:: raw-html(raw)
    :format: html

.. contents::

================================================================================
概要
================================================================================

まず検索を実行して検索にマッチするテキストを確認し、
そのテキストに対して置換処理を実行するなら :raw-html:`<kbd>Control-r /</kbd>` を使うと良いでしょう。 |BR|
入力モード、コマンドラインモードで :raw-html:`<kbd>Control-r /</kbd>` と入力すると、最後に検索に使用した検索ワードを挿入できます。 |BR|
:raw-html:`<kbd>/</kbd>` :raw-html:`<kbd>?</kbd>` を使うと、インクリメンタルサーチで細かな正規表現の結果を確認しながら検索語を作れるので、
私はよく、この方法を使用しています。



================================================================================
<C-r>
================================================================================

「<C-r>」は、 |BR|
:raw-html:`<kbd>Control</kbd>` キーを押しながら :raw-html:`<kbd>r</kbd>` キーを押す。 |BR|
というように入力してください。



================================================================================
具体的な作業手順
================================================================================

置換対象のテキストを確認
-------------------------------------------------------------------------------

まず、vimエディタの検索を実行し、置換するテキストを確認します。 |BR|
（ :raw-html:`<kbd>/</kbd>` か :raw-html:`<kbd>?</kbd>` の後に、検索条件を入力します。）

.. image:: /dist/img/howto/editing/vim_check_match_target.jpg
    :alt:  検索条件の入力


置換範囲と、置換処理のコマンドを指定
-------------------------------------------------------------------------------

次に、置換の範囲と、置換処理を指定します。

.. parsed-literal::
    :class: console

    :%s/

.. image:: /dist/img/howto/editing/vim_input_substitute_command.jpg
    :alt:  検索範囲、置換処理コマンド入力


「<C-r>」を使用して、最後に使用した検索ワードを挿入
-------------------------------------------------------------------------------

最後に使用した検索ワードは、入力モード、コマンドラインモードで

.. parsed-literal::
    :class: console

    Control-r /

と入力すると呼び出せるので、 |BR|
この :raw-html:`<kbd>Control-r /</kbd>` を使用して、検索ワードを置換対象テキストとして挿入します。

.. image:: /dist/img/howto/editing/vim_input_search_target.jpg
    :alt:  最後に入力した検索ワードを置換対象として入力


置換処理の実行
-------------------------------------------------------------------------------

最後に、置換後のテキストを入力してから、置換処理を :raw-html:`<kbd>Enter</kbd>` キーで実行します。 |BR|
（置換処理の残りのコマンドを入力）

.. image:: /dist/img/howto/editing/vim_execute_substitute_with_ctrl_r_slash.jpg
    :alt:  置換処理の残りのコマンド入力



================================================================================
同時に覚えておくと良いこと
================================================================================

入力モード、コマンドラインモードで :raw-html:`<kbd>Control-r /</kbd>` と入力すると最後に使用した検索ワードを挿入できるのは、 |BR|
最後に使用した検索ワードは :raw-html:`<kbd>/</kbd>` という名前のレジスタに格納されており、
:raw-html:`<kbd>Control-r</kbd>` で、そのレジスタの中身を貼り付けられるからです。

:raw-html:`<kbd>Control-r</kbd>` を使用すると検索ワードの他にも、さまざまなテキストを挿入できます。 |BR|
下の表は、 :raw-html:`<kbd>Control-r</kbd>` で挿入できるデータのうち、覚えておくと便利なものです。

.. csv-table:: <C-r>で挿入できるレジスタのデータ
    :header: コマンド, 説明

    <C-r> ", 最後にdelete、yankしたテキスト
    <C-r> \*, クリップボードに格納されたテキスト
    <C-r> /, 最後に使用した検索ワード
    <C-r> :, 最後に入力したvimエディタコマンド
    <C-r> %, 今開いているファイルのファイル名
    <C-r> #, 直前に開いていたファイルのファイル名



