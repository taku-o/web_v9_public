.. vim:set expandtab ff=unix ft=rest :

..  viの使い手がvimエディタについて知っておくべき事 トップ10

..  Top 10 things Vi user need to know about Vim（http://www.oualline.com/10/top_10.html）意訳。

.. |BR| raw:: html

    <br />

.. |yen|    unicode:: U+000A5 .. YEN SIGN

.. role:: raw-html(raw)
    :format: html

.. contents::

====================================================================
1. :help
====================================================================

vimエディタは豊富なオンラインヘルプが用意されています。
次のコマンドで、そのオンラインヘルプを参照できます。

.. parsed-literal::
    :class: console

    :help


====================================================================
2. 設定を有効にしないと、vimエディタの便利な機能は利用できない
====================================================================

デフォルトではvimエディタはvi互換モードで動作します。
つまり、多くのvimエディタの便利な機能は無効になっています。
もっとも簡単にそれらの機能を有効にする方法は **$HOME/.vimrc設定ファイル** を用意することです。

`これがそのサンプル`__ です。( `このファイルの説明はこちらです。`__ )

__ http://www.oualline.com/10/.vimrc
__ http://www.oualline.com/10/vimrc.html

一番最初に気がつくであろうvimエディタの機能は、
vimエディタでは複数回のアンドゥが可能であることでしょう。 
**.vimrc設定ファイル** を作成する時にきっと気づきます。


====================================================================
3. マルチウィンドウ
====================================================================

.. parsed-literal::
    :class: console

    :split

カレントウィンドウを2つに分けます。
:raw-html:`<kbd>Control-w k</kbd>` でカーソルを上のウィンドウに、
:raw-html:`<kbd>Control-w j</kbd>` でカーソルを下のウィンドウに移動できます。

.. parsed-literal::
    :class: console

    :split file.txt

ウィンドウを2つに分割し、もう一方のファイルの編集を開始します。

ウィンドウを閉じる時は、通常のvimエディタでの終了コマンドと同じく、
:raw-html:`<kbd>ZZ</kbd>` や :raw-html:`<kbd>:q</kbd>` を使用して閉じます。


====================================================================
4. ビジュアルモード
====================================================================

:raw-html:`<kbd>v</kbd>` とタイプすると、vimエディタはビジュアルモードに入ります。
ビジュアルモードではテキストを選択して、その選択したテキストの集合に、
vimエディタの編集コマンド（例えば、 :raw-html:`<kbd>d</kbd>` 、 :raw-html:`<kbd>y</kbd>` 、 :raw-html:`<kbd>></kbd>` など）を実行できます。

実際に試してみましょう。
テキストのブロックを :raw-html:`<kbd>v</kbd>` で選択し、カーソルを動かしてください。

そこで :raw-html:`<kbd>d</kbd>` コマンドを実行すると、その選択したテキストが削除されます。

:raw-html:`<kbd>v</kbd>` コマンドはテキストを文字単位で選択します。
:raw-html:`<kbd>Control-v</kbd>` コマンドはテキストをブロックとして選択します。
:raw-html:`<kbd>V</kbd>` コマンドはテキストを行単位で選択します。


====================================================================
5. 'incsearch'と'hlsearch'オプション
====================================================================

'incsearch' オプション
--------------------------------------------------------------------

デフォルトでは検索ワードを入力後に検索が実行されますが、
次のオプション **incsearch** を有効すると、インクリメンタルな検索を行うようになります。

.. parsed-literal::
    :class: console

    :set incsearch

インクリメンタル検索では、検索ワードの最初の文字を入力した時点で検索が開始されます。
そして、より多くの検索ワードを入力していくごとに、より検索結果が洗練されていきます。

'hlsearch'オプション
--------------------------------------------------------------------

**highlight search option** ('hlsearch') オプションを有効にすると、
検索結果をハイライト表示します。 |BR|
この **hlsearch** オプションは次のコマンドで有効になります。

.. parsed-literal::
    :class: console

    :set hlsearch

このオプションを有効にすると、検索にマッチしたすべてのテキストが
ハイライトされます。


====================================================================
6. 'cindent'オプションと'='コマンド
====================================================================

viエディタに前の行と同じインデントを保つ'autoindent'オプションがありましたが、
vimエディタにはもっと素晴らしいインデントの機能があります。
次のコマンドで'cindent'オプションを有効にすると、C言語スタイルのインデント機能が有効になります。

.. parsed-literal::
    :class: console

    :set cindent

この設定を有効にすると、新しい行は標準的なC言語のインデントに従って、
自動的に適切なインデントを行うようになります。


====================================================================
7. ':make'コマンド
====================================================================

あるプログラムを作成し、そのプログラムに対するMakefileも作成しました。
これから、そのプログラムをコンパイルし、エラーを修正する必要があります。
この作業を行うなら次のコマンドを実行します。

.. parsed-literal::
    :class: console

    :make

このコマンドはmakeコマンドを実行し、その実行結果を取得します。
コマンド終了後は最初のファイルに移動します。

次にエラーを修正します。
エラーの発生した行に移動するには次のコマンドを実行します。

.. parsed-literal::
    :class: console

    :cn

このコマンドを実行すると、たとえ別のファイルにあったとしても、
エラーの発生した場所まで移動できます。

:raw-html:`<kbd>:cn</kbd>` を使用して、全ての問題を修正するか、再コンパイルを実行するまで、
修正作業は続けられます。

もし途中で、もう一度エラーメッセージを見たくなったら、次のコマンドを実行してください。

.. parsed-literal::
    :class: console

    :cc


====================================================================
8. タグファイルによるナビゲーション
====================================================================

.. parsed-literal::
    :class: console

    $ ctags \*.c

コマンドで指定したファイルの全てのタグの一覧表ファイルを生成します。
このファイルの名前は'tags'になります。

このファイルをvimエディタで、プログラム編集の手助けになるツールとして使用できます。

.. parsed-literal::
    :class: console

    $ gvim -t a_function

このコマンドでvimエディタを開始すると、
"a_function"の関数定義のある位置からカーソルが始まります。
(どんなファイルであっても問題ない)

タグの操作
--------------------------------------------------------------------

"a_function"関数から"write_block"関数を呼び出すような、
次のようなコードがあるとして、

.. parsed-literal::
    :class: program

    void a_function(void)
    {
        write_block();
        //...

"write_block"関数が何をしているのか知る必要があるとしましょう。
そういった場合、カーソルを"write_block"の宣言の上に持っていき、
:raw-html:`<kbd>Control-]</kbd>` と入力してください。カーソルが"write_block"関数の位置まで移動します。
（必要なら別のファイルに移動もします）

さらに、"write_block"関数が"write_char"を呼び出しているなら、
カーソルを"write_char"の上まで移動し、 :raw-html:`<kbd>Control-]</kbd>` を押せば、
"write_char"の定義まで移動できます。

いくつかの関数定義を渡り、全てを理解したのなら、 :raw-html:`<kbd>Control-t</kbd>` で1つ前の位置に戻れます。
すなわち、 :raw-html:`<kbd>Control-t</kbd>` で"write_char"関数から"write_block"関数の位置に戻れ、
次の :raw-html:`<kbd>Control-t</kbd>` で、"write_block"から"a_function"の位置に戻れる、ということです。


====================================================================
9. 略語
====================================================================

私は、次の略語を、$HOME/.vimrc設定ファイルで定義しています。

.. parsed-literal::
    :class: program

    :ab #b /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
    :ab #e ^V^H\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/

この定義は、ボックスコメントを簡単に作成するためのものです。
:raw-html:`<kbd>#b</kbd>` とタイプするとボックスコメントの上部分を出力し、
:raw-html:`<kbd>#e</kbd>` とタイプするとボックスコメントの下部分を出力します。
（コメントの頭には「^V^H」を入れています。）

これらの略語は、タブ使用時に、コメントの端を合わせられるように設定してあります。


====================================================================
10. 単語補完
====================================================================

単語を途中まで入力中に、 :raw-html:`<kbd>Control-p</kbd>` で上の方を検索してマッチするワードで補完、
:raw-html:`<kbd>Control-n</kbd>` で下の方を検索してマッチするワードで補完できる。



